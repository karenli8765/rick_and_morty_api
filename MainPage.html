<!DOCTYPE html>
<html>
<head>
<style>
  body {
    color: lime;
    font-weight: bold;
    font-size: 30px;
    text-align: center;

    background-image: url("background.jpg"); /* image source: https://wallpapersden.com/galaxy-rick-and-morty-wallpaper/2560x1600/*/
    background-size: cover;
    background-position: center center;
    background-attachment: fixed;
  }
</style>
</head>
<body onload="loadFunction()">

<script>
var locations = null;
var residents = null;

function loadFunction() {
  fetch('https://rickandmortyapi.com/api/location/')
  .then((response) => response.json())
  .then((json) => {
    locations = new Array(json.info.count);
    pages = json.info.pages;
    pages_done = 1;
    for (let i = 0; i < json.results.length; i++) {
      locations[json.results[i].id - 1] = json.results[i];
    }

    for (let p = 1; p < pages; p++) {
      page_id = p + 1;
      fetch('https://rickandmortyapi.com/api/location/?page='+page_id)
      .then((response) => response.json())
      .then((json) => {
        for (let i = 0; i < json.results.length; i++) {
          locations[json.results[i].id - 1] = json.results[i];
        }

        pages_done++;
        if (pages_done == pages) {
          locationLoaded();
        }
      })
    }
  })
}

function locationLoaded() {
  console.log("location loaded");
  console.log(locations);

  var select_location = document.getElementsByName("location")[0];
  for (let i = 0; i < locations.length; i++) {
    let opt = document.createElement("option");
    opt.value = locations[i].id;
    opt.innerHTML = "Name: " + locations[i].name + " | Type: " + locations[i].type;
    select_location.appendChild(opt);
  }
}

function getResidents(location_info) {
  location_id = location_info.options[location_info.selectedIndex].value;
  ids = "";
  residents = locations[location_id - 1].residents;
  for (let i = 0; i < residents.length; i++) {
    res = residents[i];
    id = res.split("/")[5];
    if (i == 0) {
      ids = id;
    }
    else {
      ids += "," + id;
    }
  }
  console.log(ids)

  var select_resident = document.getElementsByName("resident")[0];
  select_resident.length = 0;
  residents = null;

  if (ids == "") {
    return;
  }

  fetch("https://rickandmortyapi.com/api/character/"+ids)
  .then((response) => response.json())
  .then((json) => {
    console.log(json);
    if (Array.isArray(json)) {
      residents = new Array(json.length);
      for (let i = 0; i < json.length; i++) {
        let opt = document.createElement("option");
        residents[i] = json[i];
        opt.innerHTML = json[i].name;
        select_resident.appendChild(opt);
      }
    }
    else {
      residents = new Array(1);
      let opt = document.createElement("option");
      residents[0] = json;
      opt.innerHTML = json.name;
      select_resident.appendChild(opt);
    }
  })
}

function getDetail(resident_info) {
  show_detail = document.getElementsByName("detail")[0];
  detail = residents[resident_info.selectedIndex];
  show_detail.innerHTML = "Name: " + detail.name + "<br>";
  show_detail.innerHTML += "Status: " + detail.status + "<br>";
  show_detail.innerHTML += "<img src=" + detail.image + ">";
}

function createCommentsBox(resident_info) {
  show_comments_box = document.getElementsByName("comment")[0]
  var textbox = document.createElement("input");
  textbox.setAttribute("type", "text");
  show_comments_box.appendChild(textbox);
}

</script>

<div>
  <div>
      Locations:<br>
      <select name="location" size="20" style="width: 500px;" onchange="getResidents(this)">

      </select>
  </div>
  <div>
      Charactors:<br>
      <select name="resident" size="20" style="width: 500px;" onchange="getDetail(this)">

      </select>
  </div>
</div>

<div>
  Character details: <br>
  <div name="detail">

  </div>
  <div name="comment">

  </div>
</div>


</body>
</html>

